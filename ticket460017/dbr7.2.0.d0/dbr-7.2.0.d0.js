//dbr 7.2.0.d0
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.dbr=t():e.dbr=t()}(window,function(){return function(e){var t={};function i(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(o,s,function(t){return e[t]}.bind(null,s));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";var o,s;i.r(t),function(e){e[e.IPF_Binary=0]="IPF_Binary",e[e.IPF_BinaryInverted=1]="IPF_BinaryInverted",e[e.IPF_GrayScaled=2]="IPF_GrayScaled",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616"}(o||(o={})),function(e){e[e.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",e[e.DBR_SUCCESS=0]="DBR_SUCCESS",e[e.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",e[e.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",e[e.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",e[e.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",e[e.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",e[e.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",e[e.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",e[e.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",e[e.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",e[e.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",e[e.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",e[e.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",e[e.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",e[e.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",e[e.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",e[e.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",e[e.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",e[e.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",e[e.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",e[e.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",e[e.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",e[e.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",e[e.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",e[e.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",e[e.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",e[e.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",e[e.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",e[e.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",e[e.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",e[e.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",e[e.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",e[e.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",e[e.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",e[e.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",e[e.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",e[e.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",e[e.DBR_DBRERR_AZTEC_LICENSE_INVALID=-10041]="DBR_DBRERR_AZTEC_LICENSE_INVALID"}(s||(s={}));var n,r=function(e,t,i,o){return new(i||(i=Promise))(function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,a)}d((o=o.apply(e,t||[])).next())})};class a{constructor(){this._instanceID=void 0}static get productKeys(){return this._productKeys}static set productKeys(e){if("unload"!=this._loadWasmStatus)throw new Error("`productKeys` is not allowed to change ProductKeys after loadWasm is called.");this._productKeys=e}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if("unload"!=this._loadWasmStatus)throw new Error("`engineResourcePath` is not allowed to change ProductKeys after loadWasm is called.");this._engineResourcePath=e}static isLoaded(){return"loadSuccess"==this._loadWasmStatus}static loadWasm(){return r(this,void 0,void 0,function*(){return yield new Promise((e,t)=>r(this,void 0,void 0,function*(){switch(this._loadWasmStatus){case"unload":{this._loadWasmStatus="loading";let e=this.engineResourcePath+this._workerName;this.engineResourcePath.startsWith(document.origin)||(e=yield fetch(e).then(e=>e.blob()).then(e=>URL.createObjectURL(e))),this._dbrWorker=new Worker(this._workerName),this._dbrWorker.onerror=e=>{for(let t of this._loadWasmCallbackArr)t(new Error(e.message))},this._dbrWorker.onmessage=e=>{let t=e.data;switch(t.type){case"log":a._onLog&&a._onLog(t.message);break;case"load":if(t.success){this._loadWasmStatus="loadSuccess",a.version=t.version+"(JS "+a._jsVersion+"."+a._jsEditVersion+")",a._onLog&&a._onLog("load dbr worker success");for(let e of a._loadWasmCallbackArr)e();a._dbrWorker.onerror=null}break;case"task":{let e=t.id,i=t.body;try{a._taskCallbackMap.get(e)(i),a._taskCallbackMap.delete(e)}catch(t){throw a._taskCallbackMap.delete(e),t}break}default:a._onLog&&a._onLog(e)}},this._dbrWorker.postMessage({type:"loadWasm",productKeys:this.productKeys,engineResourcePath:this.engineResourcePath,bWasmDebug:this._bWasmDebug,version:this._jsVersion})}case"loading":this._loadWasmCallbackArr.push(i=>{i?t(i):e()});break;case"loadSuccess":e();break;case"loadFail":t()}}))})}static createInstanceInWorker(e){return r(this,void 0,void 0,function*(){return yield a.loadWasm(),yield new Promise((t,i)=>{let o=this._nextTaskID++;a._taskCallbackMap.set(o,e=>{if(e.success)return t(e.instanceID);{let t=new Error(e.message);return t.stack+="\n"+e.stack,i(t)}}),a._dbrWorker.postMessage({type:"createInstance",id:o,productKeys:"",bScanner:!!e})})})}static createInstance(e){return r(this,void 0,void 0,function*(){let e=new a;return e._instanceID=yield a.createInstanceInWorker(),e})}decode(e){return r(this,void 0,void 0,function*(){return a._onLog&&a._onLog("decode(source: any)"),e instanceof Blob?yield this._decode_Blob(e):e instanceof ArrayBuffer?yield this._decode_ArrayBuffer(e):e instanceof Uint8Array||e instanceof Uint8ClampedArray?yield this._decode_Uint8Array(e):e instanceof HTMLImageElement||e instanceof ImageBitmap?yield this._decode_Image(e):e instanceof HTMLCanvasElement?yield this._decode_Canvas(e):e instanceof HTMLVideoElement?yield this._decode_Video(e):"string"==typeof e||e instanceof String?"data:image/"==e.substring(0,11)?yield this._decode_Base64(e):yield this._decode_Url(e):yield Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))})}_decodeBuffer_Uint8Array(e,t,i,o,s,n){return r(this,void 0,void 0,function*(){return a._onLog&&a._onLog("_decodeBuffer_Uint8Array(buffer,width,height,stride,format)"),yield new Promise((r,d)=>{let l=a._nextTaskID++;a._taskCallbackMap.set(l,e=>{if(e.success){let t=e.decodeReturn;return r(this._handleRetJsonString(t))}{let t=new Error(e.message);return t.stack+="\n"+e.stack,d(t)}}),a._dbrWorker.postMessage({type:"decodeBuffer",id:l,instanceID:this._instanceID,body:{buffer:e,width:t,height:i,stride:o,format:s,config:n}})})})}_decodeBuffer_Blob(e,t,i,o,s,n){return r(this,void 0,void 0,function*(){return a._onLog&&a._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)"),yield new Promise((t,i)=>{let o=new FileReader;o.readAsArrayBuffer(e),o.onload=()=>{console.log(o.result),t(o.result)},o.onerror=()=>{i(o.error)}}).then(e=>(console.log(new Uint8Array(e)),this._decodeBuffer_Uint8Array(new Uint8Array(e),t,i,o,s,n)))})}decodeBuffer(e,t,i,o,s,n){return r(this,void 0,void 0,function*(){let r;return a._onLog&&a._onLog("decodeBuffer(buffer,width,height,stride,format)"),e instanceof Uint8Array||e instanceof Uint8ClampedArray?r=yield this._decodeBuffer_Uint8Array(e,t,i,o,s,n):e instanceof ArrayBuffer?r=yield this._decodeBuffer_Uint8Array(new Uint8Array(e),t,i,o,s,n):e instanceof Blob&&(r=yield this._decodeBuffer_Blob(e,t,i,o,s,n)),r})}getRuntimeSettings(){return r(this,void 0,void 0,function*(){return yield new Promise((e,t)=>{let i=a._nextTaskID++;a._taskCallbackMap.set(i,i=>{if(i.success)return e(JSON.parse(i.results));{let e=new Error(i.message);return e.stack+="\n"+i.stack,t(e)}}),a._dbrWorker.postMessage({type:"getRuntimeSettings",id:i,instanceID:this._instanceID})})})}updateRuntimeSettings(e){return r(this,void 0,void 0,function*(){let t;if("string"==typeof e||"object"==typeof e&&e instanceof String)t=e;else{if("object"!=typeof e)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");t=JSON.stringify(e)}return this._runtimeSettings=t,yield new Promise((e,i)=>{let o=a._nextTaskID++;a._taskCallbackMap.set(o,t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack+="\n"+t.stack,i(e)}}),a._dbrWorker.postMessage({type:"updateRuntimeSettings",id:o,instanceID:this._instanceID,body:{settings:t}})})})}resetRuntimeSettings(){return r(this,void 0,void 0,function*(){return yield new Promise((e,t)=>{let i=a._nextTaskID++;a._taskCallbackMap.set(i,i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack+="\n"+i.stack,t(e)}}),a._dbrWorker.postMessage({type:"resetRuntimeSettings",id:i,instanceID:this._instanceID})})})}outputSettingsToString(){return r(this,void 0,void 0,function*(){return yield new Promise((e,t)=>{let i=a._nextTaskID++;a._taskCallbackMap.set(i,i=>{if(i.success)return console.log(i.results),e(i.results);{let e=new Error(i.message);return e.stack+="\n"+i.stack,t(e)}}),a._dbrWorker.postMessage({type:"outputSettingsToString",id:i,instanceID:this._instanceID})})})}initRuntimeSettingsWithString(e){return r(this,void 0,void 0,function*(){if("string"==typeof e||"object"==typeof e&&e instanceof String)e=e;else{if("object"!=typeof e)throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");e=JSON.stringify(e)}return yield new Promise((t,i)=>{let o=a._nextTaskID++;a._taskCallbackMap.set(o,e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack+="\n"+e.stack,i(t)}}),a._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:o,instanceID:this._instanceID,body:{settings:e}})})})}destroy(){return a._onLog&&a._onLog("destroy()"),new Promise((e,t)=>{let i=a._nextTaskID++;a._taskCallbackMap.set(i,i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack+="\n"+i.stack,t(e)}}),a._dbrWorker.postMessage({type:"destroy",id:i,instanceID:this._instanceID})})}_decode_Blob(e,t){return r(this,void 0,void 0,function*(){a._onLog&&a._onLog("_decode_Blob(blob: Blob)");let i=null,o=null;if("undefined"!=typeof createImageBitmap)try{i=yield createImageBitmap(e)}catch(e){}i||(o=yield function(e){return new Promise((t,i)=>{let o=URL.createObjectURL(e),s=new Image;s.dbrObjUrl=o,s.src=o,s.onload=()=>{t(s)},s.onerror=e=>{i(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}})}(e));let s=yield this._decode_Image(i||o,t);return i&&i.close(),s})}_decode_ArrayBuffer(e,t){return r(this,void 0,void 0,function*(){return yield this._decode_Blob(new Blob(e),t)})}_decode_Uint8Array(e,t){return r(this,void 0,void 0,function*(){return yield this._decode_Blob(new Blob(e),t)})}_decode_Image(e,t){return r(this,void 0,void 0,function*(){a._onLog&&a._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)");let i,o,s=e instanceof HTMLImageElement?e.naturalWidth:e.width,n=e instanceof HTMLImageElement?e.naturalHeight:e.height,r=document.createElement("canvas"),d=Math.max(s,n);if(d>a._canvasMaxWH){let e=a._canvasMaxWH/d;i=Math.round(s*e),o=Math.round(n*e)}else i=s,o=n;let l=r.getContext("2d");switch(t&&t._videoOrientation){case 3:r.width=i,r.height=o,l.setTransform(-1,0,0,-1,i,o);break;case 6:r.width=o,r.height=i,l.setTransform(0,1,-1,0,o,0);break;case 8:r.width=o,r.height=i,l.setTransform(0,-1,1,0,0,i);break;default:r.width=i,r.height=o}return l.drawImage(e,0,0,i,o),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),yield this._decode_Canvas(r,t)})}_decode_Canvas(e,t){return r(this,void 0,void 0,function*(){if(a._onLog&&a._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";let i=e.getContext("2d").getImageData(0,0,e.width,e.height).data;return yield this._decodeBuffer_Uint8Array(i,e.width,e.height,4*e.width,o.IPF_ARGB_8888,t)})}_decode_Video(e,t){return r(this,void 0,void 0,function*(){let i;return a._onLog&&a._onLog("_decode_Video(video)"),t=t||{},yield new Promise(o=>{if(!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";let s=0,n=0,r=e.videoWidth,a=e.videoHeight,d=e.videoWidth,l=e.videoHeight;null!=t.sx&&(s=t.sx),null!=t.sy&&(n=t.sy),null!=t.sWidth&&(r=t.sWidth),null!=t.sHeight&&(a=t.sHeight),null!=t.dWidth&&(d=t.dWidth),null!=t.dHeight&&(l=t.dHeight),s>0&&s<=1&&(s=Math.round(s*e.videoWidth)),n>0&&n<=1&&(n=Math.round(n*e.videoHeight)),r<=1&&(r=Math.round(r*e.videoWidth)),a<=1&&(a=Math.round(a*e.videoHeight)),d<=1&&(d=Math.round(d*e.videoWidth)),l<=1&&(l=Math.round(l*e.videoHeight)),(i=document.createElement("canvas")).width=d,i.height=l;let _=i.getContext("2d");0==s&&0==n&&e.videoWidth==r&&e.videoHeight==a&&e.videoWidth==d&&e.videoHeight==l?_.drawImage(e,0,0):_.drawImage(e,s,n,r,a,0,0,d,l),o(this._decode_Canvas(i,t))})})}_decode_Base64(e,t){return r(this,void 0,void 0,function*(){return a._onLog&&a._onLog("_decode_Base64(base64Str)"),"string"!=typeof e&&"object"!=typeof e?Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'String'."):("data:image/"==e.substring(0,11)&&(e=e.substring(e.indexOf(",")+1)),yield new Promise(i=>{let o=atob(e),s=o.length,n=new Uint8Array(s);for(;s--;)n[s]=o.charCodeAt(s);i(this._decode_Blob(new Blob([n]),t))}))})}_decode_Url(e,t){return r(this,void 0,void 0,function*(){if(a._onLog&&a._onLog("_decode_Url(url)"),"string"!=typeof e&&"object"!=typeof e)throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'String'.");return yield new Promise((i,o)=>{let s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="blob",s.send(),s.onloadend=()=>r(this,void 0,void 0,function*(){i(yield this._decode_Blob(s.response,t))}),s.onerror=()=>{o(s.onerror)}})})}static BarcodeReaderException(e,t){let i,o=s.DBR_UNKNOWN;return"number"==typeof e?(o=e,i=new Error(t)):i=new Error(e),i.code=o,i}_handleRetJsonString(e){let t=s;switch(e.exception){case t.DBR_SUCCESS:case t.DBR_LICENSE_INVALID:case t.DBR_LICENSE_EXPIRED:case t.DBR_1D_LICENSE_INVALID:case t.DBR_QR_LICENSE_INVALID:case t.DBR_PDF417_LICENSE_INVALID:case t.DBR_DATAMATRIX_LICENSE_INVALID:case t.DBR_DBRERR_AZTEC_LICENSE_INVALID:case t.DBR_RECOGNITION_TIMEOUT:if(e.textResults)for(let t=0;t<e.textResults.length;t++){let i=e.textResults[t];try{let e=i.barcodeBytes,t="";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);try{i.BarcodeText=decodeURIComponent(escape(t))}catch(e){i.BarcodeText=t}}catch(e){i.BarcodeText=""}}return e.textResults;default:throw a.BarcodeReaderException(e.exception,e.description)}}}a._jsVersion="7.2.0.d0",a._jsEditVersion="20190918",a.version="loading...(JS "+a._jsVersion+"."+a._jsEditVersion+")",a._productKeys=(()=>document.currentScript&&(document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey"))||"")(),a._workerName="dbr-"+a._jsVersion+".worker.js",a._bUseIndexDB=!0,a._engineResourcePath=(()=>{if(document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),a._isShowRelDecodeTimeInResults=!1,a._canvasMaxWH=4096,a._bWasmDebug=!1,a._bWithio=void 0,a._nextTaskID=0,a._taskCallbackMap=new Map,a._loadWasmStatus="unload",a._loadWasmCallbackArr=[],function(e){e[e.All=503317503]="All",e[e.OneD=1023]="OneD",e[e.CODE_39=1]="CODE_39",e[e.CODE_128=2]="CODE_128",e[e.CODE_93=4]="CODE_93",e[e.CODABAR=8]="CODABAR",e[e.ITF=16]="ITF",e[e.EAN_13=32]="EAN_13",e[e.EAN_8=64]="EAN_8",e[e.UPC_A=128]="UPC_A",e[e.UPC_E=256]="UPC_E",e[e.INDUSTRIAL_25=512]="INDUSTRIAL_25",e[e.PDF417=33554432]="PDF417",e[e.QR_CODE=67108864]="QR_CODE",e[e.DATAMATRIX=134217728]="DATAMATRIX",e[e.AZTEC=268435456]="AZTEC"}(n||(n={}));var d=function(e,t,i,o){return new(i||(i=Promise))(function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,a)}d((o=o.apply(e,t||[])).next())})};class l extends a{constructor(){super(),this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.intervalTime=100,this.duplicateForgetTime=3e3,this._isOpen=!1,this._lastDeviceId=void 0,this.arrDiffCodeInfo=[],this._intervalDetectVideoPause=1e3,this._video=null,this._cvsDrawArea=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._videoTrack=null,this._frameCount=0,this._1DRememberFrameCount=5,this._1DTrustFrameCount=2,this._videoCapabilities=null,this._onCameraSelChange=()=>{this.play(this._selCam.value).then(()=>{this._isOpen||this.stop()}).catch(e=>{alert("Play video failed: "+(e.message||e))})},this._onResolutionSelChange=()=>{let e,t;if(this._selRsl&&-1!=this._selRsl.selectedIndex){let i=this._selRsl.options[this._selRsl.selectedIndex];e=i.getAttribute("data-width"),t=i.getAttribute("data-height")}this.play(void 0,e,t).then(()=>{this._isOpen||this.stop()}).catch(e=>{alert("Play video failed: "+(e.message||e))})},this.UIElement=(()=>{const e=document.createElement("div");return e.style.width="100%",e.style.minWidth="100px",e.style.height="100%",e.style.minHeight="100px",e.style.left="0",e.style.top="0",e.style.background="#eee",e.style.display="none",e.innerHTML=['<p style="width:100%;height:32px;line-height:32px;position:absolute;margin:auto 0;top:0;bottom:0;text-align:center;">loading</p>','<video class="dbrScanner-video" playsinline="true" style="width:100%;height:100%;position:absolute;left:0;top:0;"></video>','<canvas class="dbrScanner-cvs-draw-area" style="width:100%;height:100%;position:absolute;left:0;top:0;"></canvas>','<select class="dbrScanner-sel-camera" style="position:absolute;left:0;top:0;">',"</select>",'<select class="dbrScanner-sel-resolution" style="position:absolute;left:0;top:20px;">',"</select>",'<button class="dbrScanner-btn-close" style="position:absolute;right:0;top:0;">','<svg width="16" height="16" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg>',"</button>"].join(""),e})()}static createInstance(e){return d(this,void 0,void 0,function*(){let e=new l;return e._instanceID=yield l.createInstanceInWorker(!0),e})}_bindUI(){let e=[this.UIElement],t=this.UIElement.children;for(let i of t)e.push(i);for(let t=0;t<e.length;++t)for(let i of e[t].children)e.push(i);for(let t of e)!this._video&&t.classList.contains("dbrScanner-video")?this._video=t:!this._cvsDrawArea&&t.classList.contains("dbrScanner-cvs-drawArea")?this._cvsDrawArea=t:!this._selCam&&t.classList.contains("dbrScanner-sel-camera")?this._selCam=t:!this._selRsl&&t.classList.contains("dbrScanner-sel-resolution")?(this._selRsl=t,this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dbrScanner-opt-gotResolution" value="got"></option>','<option data-width="3840" data-height="2160">ask 3840 x 2160</option>','<option data-width="2560" data-height="1440">ask 2560 x 1440</option>','<option data-width="1920" data-height="1080">ask 1920 x 1080</option>','<option data-width="1600" data-height="1200">ask 1600 x 1200</option>','<option data-width="1280" data-height="720">ask 1280 x 720</option>','<option data-width="800" data-height="600">ask 800 x 600</option>','<option data-width="640" data-height="480">ask 640 x 480</option>','<option data-width="640" data-height="360">ask 640 x 360</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&t.classList.contains("dbrScanner-opt-gotResolution")?this._optGotRsl=t:!this._btnClose&&t.classList.contains("dbrScanner-btn-close")&&(this._btnClose=t);if(this._selCam&&this._selCam.addEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.addEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.addEventListener("click",this.hide),this.UIElement.parentNode||(this.UIElement.style.position||(this.UIElement.style.position="fixed"),document.body.appendChild(this.UIElement)),!this._video)throw this._unbindUI(),Error("Can not find HTMLVideoElement with class `dbrScanner-video`.");this._isOpen=!0}_unbindUI(){this._video=null,this._cvsDrawArea=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this.hide),this._isOpen=!1}_getAllVideoDevices(){return d(this,void 0,void 0,function*(){const e=yield navigator.mediaDevices.enumerateDevices(),t=[];for(let i=0;i<e.length;i++){let o,s=e[i];"videoinput"==s.kind&&((o={}).deviceId=s.deviceId,o.label=s.label||"camera "+i,t.push(o))}return Promise.resolve(t)})}_renderSelCameraInfo(){return d(this,void 0,void 0,function*(){let e,t,i=yield this._getAllVideoDevices();this._selCam&&(e=this._selCam.value,this._selCam.innerHTML="");let o=void 0;if(this._video)for(let e of this._video.srcObject.getVideoTracks()){if(o)break;for(let t of i)if(e.label==t.label){o=t,this._lastDeviceId=t.deviceId;break}}if(this._selCam){for(let o of i){let i=document.createElement("option");i.value=o.deviceId,i.innerText=o.label,this._selCam.appendChild(i),e==o.deviceId&&(t=i)}let s=this._selCam.childNodes;if(!t&&o&&s.length)for(let e of s)if(o.label==e.innerText){t=e;break}t&&(this._selCam.value=t.value)}return Promise.resolve(o)})}updateDevice(){return d(this,void 0,void 0,function*(){const e=yield this._getAllVideoDevices(),t=yield this._renderSelCameraInfo();return Promise.resolve({current:t,all:e})})}getCompatibility(){return{torch:this._videoCapabilities&&this._videoCapabilities.torch||!1,focus:!1}}getAllCameras(){return d(this,void 0,void 0,function*(){return yield this._getAllVideoDevices()})}getCurrentCamera(){return d(this,void 0,void 0,function*(){return yield this.updateDevice().then(e=>e.current)})}setCurrentCamera(e){return d(this,void 0,void 0,function*(){return yield this.play(e.deviceId||e)})}getResolution(){return this._isOpen?[this._video.videoWidth,this._video.videoHeight]:null}setResolution(e,t){return d(this,void 0,void 0,function*(){let i,o;return this._isOpen?(e instanceof Array?(i=e[0],o=e[1]):(i=e,o=t),yield this.play(null,i,o)):yield Promise.reject()})}getScanSettings(){return{duplicateForgetTime:this.duplicateForgetTime,intervalTime:this.intervalTime}}updateScanSettings(e){this.duplicateForgetTime=e.duplicateForgetTime,this.intervalTime=e.intervalTime}getUIElement(){return this.UIElement}setUIElement(e){this.UIElement=e}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){return this.videoSettings=JSON.parse(JSON.stringify(e)),this._isOpen?this.play():Promise.resolve()}isOpen(){return this._isOpen}_show(){"none"==this.UIElement.style.display&&(this.UIElement.style.display="")}_hide(){this.UIElement.style.display}stop(){this._video&&this._video.srcObject&&(a._onLog&&a._onLog("======stop video========"),this._video.srcObject=null)}pause(){this._video&&this._video.pause()}play(e,t,i){return d(this,void 0,void 0,function*(){if(!this._isOpen)throw new Error("The scanner is not open.");this.stop(),a._onLog&&a._onLog("======before video========");const o=this.videoSettings;let s;"boolean"==typeof o.video&&(o.video={}),/Safari/.test(navigator.userAgent)&&/iPhone/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?t>=1280?o.video.width=1280:t>=640?o.video.width=640:t>=320&&(o.video.width=320):(t||i)&&(t&&(o.video.width={ideal:t}),i&&(o.video.height={ideal:i})),e?(delete o.video.facingMode,o.video.deviceId={exact:e},this._lastDeviceId=e):o.video.deviceId||this._lastDeviceId&&(delete o.video.facingMode,o.video.deviceId={ideal:this._lastDeviceId}),a._onLog&&a._onLog("======try getUserMedia========"),a._onLog&&a._onLog("ask "+JSON.stringify(o.video.width)+"x"+JSON.stringify(o.video.height));try{s=yield navigator.mediaDevices.getUserMedia(o)}catch(e){a._onLog&&a._onLog("======try getUserMedia again========"),a._onLog&&a._onLog(e),o.video.width=void 0,o.video.height=void 0,s=yield navigator.mediaDevices.getUserMedia(o)}this._video.srcObject=s,a._onLog&&a._onLog("======play video========"),yield this._video.play(),a._onLog&&a._onLog("======played video========");const n="got "+this._video.videoWidth+"x"+this._video.videoHeight;return this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=n,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),a._onLog&&a._onLog(n),{width:this._video.videoWidth,height:this._video.videoHeight}})}turnOffTorch(){}turnOnTorch(){}_cloneDecodeResults(e){if(e instanceof Array){let t=[];for(let i of e)t.push(this._cloneDecodeResults(i));return t}{let t=e;return JSON.parse(JSON.stringify(t,(e,t)=>"oriVideoCanvas"==e||"searchRegionCanvas"==e?void 0:t))}}_loopReadVideo(){if(!this._isOpen)return;if(this._video.paused)return a._onLog&&a._onLog("Video is paused. Ask in 1s."),void setTimeout(()=>{this._loopReadVideo()},this._intervalDetectVideoPause);a._onLog&&a._onLog("======= once read =======");(new Date).getTime();this._decode_Video(this._video).then(e=>{if(a._onLog&&a._onLog(e),this.onFrameRead&&this.onFrameRead(this._cloneDecodeResults(e)),this.onUnduplicatedRead)for(let t of e)t.bUnduplicated&&this.onUnduplicatedRead(t.BarcodeText,this._cloneDecodeResults(t));setTimeout(()=>{this._loopReadVideo()},this.intervalTime)}).catch(e=>{if(a._onLog&&a._onLog(e.message||e),setTimeout(()=>{this._loopReadVideo()},this.intervalTime),"platform error"!=e.message)throw console.error(e.message),e})}open(){return d(this,void 0,void 0,function*(){this._bindUI(),this._show();let e=yield this.play();return this._loopReadVideo(),e})}close(){this.stop(),this._unbindUI()}show(){return d(this,void 0,void 0,function*(){this._bindUI(),this._show();let e=yield this.play();return this._loopReadVideo(),e})}hide(){this.stop(),this._hide(),this._unbindUI()}}i.d(t,"BarcodeReader",function(){return a}),i.d(t,"BarcodeScanner",function(){return l});t.default={BarcodeReader:a,BarcodeScanner:l}}])});
let Dynamsoft = dbr;